---
import BaseHead from '../components/BaseHead.astro';
import { SITE_TITLE, SITE_DESCRIPTION } from '../consts';

const { title = 'Panel de Administraci贸n', description = SITE_DESCRIPTION, activeLink = '' } = Astro.props;

// Este layout ahora maneja la autenticaci贸n directamente
console.log('AdminLayout: Renderizando layout administrativo');

// Determinar si estamos en la p谩gina de login
const isInLoginPage = Astro.url.pathname === '/admin/login';
const isAuth = !isInLoginPage; // Si no estamos en login, asumimos que estamos autenticados (la verificaci贸n real se hace en cada p谩gina)

// Funci贸n para determinar si un enlace est谩 activo
const isActive = (link: string) => activeLink === link;
---

<html lang="es">
	<head>
		<BaseHead title={`${title} | ${SITE_TITLE}`} description={description} />
	</head>
	<body class="min-h-screen flex flex-col bg-white">
		<main class="flex-grow">
      <div class="container mx-auto px-4 py-8">
        <div class="flex flex-wrap">
          <!-- Sidebar de navegaci贸n mejorado con estado activo -->          
          {isAuth && (
            <aside class="w-full md:w-1/5 pr-4">
              <nav class="bg-primary rounded-lg shadow-lg p-4">
                <h2 class="text-white font-bold text-xl mb-4">Administraci贸n</h2>
                <ul class="space-y-2">
                  <li>
                    <a 
                      href="/admin" 
                      class={`text-white flex items-center p-2 rounded-md transition-colors ${isActive('dashboard') ? 'bg-[#2a3a4f] font-medium' : 'hover:bg-[#2a3a4f] hover:text-secondary'}`}
                    >
                      <span class="mr-2"></span> Dashboard
                    </a>
                  </li>
                  <li>
                    <a 
                      href="/admin/productos" 
                      class={`text-white flex items-center p-2 rounded-md transition-colors ${isActive('productos') ? 'bg-[#2a3a4f] font-medium' : 'hover:bg-[#2a3a4f] hover:text-secondary'}`}
                    >
                      <span class="mr-2"></span> Productos
                    </a>
                  </li>
                  <li>
                    <a 
                      href="/admin" 
                      class={`text-white flex items-center justify-between p-2 rounded-md transition-colors ${isActive('pedidos') ? 'bg-[#2a3a4f] font-medium' : 'hover:bg-[#2a3a4f] hover:text-secondary'} min-h-[40px]`}
                    >
                      <div class="flex items-center">
                        <span class="mr-2"></span> Pedidos
                      </div>
                      <span class="text-xs bg-accent/80 text-white px-1.5 py-0.5 rounded whitespace-nowrap inline-block max-w-[60px] sm:max-w-[90px] text-center overflow-hidden text-ellipsis">Pr贸x.</span>
                    </a>
                  </li>
                  <li>
                    <a 
                      href="/admin" 
                      class={`text-white flex items-center justify-between p-2 rounded-md transition-colors ${isActive('clientes') ? 'bg-[#2a3a4f] font-medium' : 'hover:bg-[#2a3a4f] hover:text-secondary'} min-h-[40px]`}
                    >
                      <div class="flex items-center">
                        <span class="mr-2"></span> Clientes
                      </div>
                      <span class="text-xs bg-accent/80 text-white px-1.5 py-0.5 rounded whitespace-nowrap inline-block max-w-[60px] sm:max-w-[90px] text-center overflow-hidden text-ellipsis">Pr贸x.</span>
                    </a>
                  </li>
                  <li>
                    <a 
                      href="/admin" 
                      class={`text-white flex items-center justify-between p-2 rounded-md transition-colors ${isActive('configuracion') ? 'bg-[#2a3a4f] font-medium' : 'hover:bg-[#2a3a4f] hover:text-secondary'} min-h-[40px]`}
                    >
                      <div class="flex items-center">
                        <span class="mr-2">锔</span> Configuraci贸n
                      </div>
                      <span class="text-xs bg-accent/80 text-white px-1.5 py-0.5 rounded whitespace-nowrap inline-block max-w-[60px] sm:max-w-[90px] text-center overflow-hidden text-ellipsis">Pr贸x.</span>
                    </a>
                  </li>
                  <li>
                    <button id="logout-btn" class="w-full text-left text-white hover:text-accent flex items-center p-2 rounded-md hover:bg-[#2a3a4f] transition-colors">
                      <span class="mr-2"></span> Cerrar sesi贸n
                    </button>
                  </li>
                </ul>
              </nav>
            </aside>
          )}
          
          <!-- Contenido principal con m谩s espacio y mejor jerarqu铆a visual -->
          <div class={`w-full ${isAuth ? 'md:w-4/5' : 'md:w-full'}`}>
            <div class="bg-white rounded-lg shadow-lg p-6">
              <slot /></div>
          </div>
        </div>
      </div>
		</main>
    
    {isAuth && (
      <script>
        // Script para manejar el cierre de sesi贸n
        document.getElementById('logout-btn')?.addEventListener('click', async () => {
          try {
            const response = await fetch('/api/auth/logout', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json'
              }
            });
            
            if (response.ok) {
              window.location.href = '/admin/login';
            } else {
              console.error('Error al cerrar sesi贸n');
            }
          } catch (error) {
            console.error('Error:', error);
          }
        });
      </script>
    )}
	</body>
</html>
